var T=Object.defineProperty;var H=(e,t,r)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var o=(e,t,r)=>(H(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();class M{getPos(){return this.pos}getColor(){return this.color}}const p=24,f=18,a=10;function S(e){return e.x<0||e.x>=p||e.y<0||e.y>=f}function R(e){for(;;){let t={x:Math.floor(Math.random()*p),y:Math.floor(Math.random()*f)};if(!g(t,e))return t}}function g(e,t){for(let r=0;r<t.length;r++)if(m(e,t[r]))return!0;return!1}function m(e,t){return e.x==t.x&&e.y==t.y}function d(e,t){return m(e,t)}function G(e,t){return{x:e.x-t.x,y:e.y-t.y}}function u(e,t){return{x:e.x+t.x,y:e.y+t.y}}function N(e){return e.x==0&&e.y==0}function v(e){return{x:e.y,y:-e.x}}function k(e){return{x:-e.y,y:e.x}}function V(e){return{x:-e.x,y:-e.y}}class $ extends M{constructor(){super();o(this,"pos");o(this,"color");o(this,"tail");o(this,"vel",{x:0,y:0});this.pos={x:Math.floor(p/2),y:Math.floor(f/2)},this.color="#ffffff",this.tail=[]}move(){if(this.tail.length>0){for(let r=this.tail.length-1;r>0;r--)this.tail[r].pos=Object.assign({},this.tail[r-1].pos);this.tail[0].pos=Object.assign({},this.pos)}this.pos=u(this.pos,this.vel)}grow(){this.tail.push({pos:Object.assign({},this.pos),color:j()})}}function j(){const r=Math.floor(Math.random()*128)+128,s=Math.floor(Math.random()*128)+128,n=Math.floor(Math.random()*128)+128,i=r.toString(16).padStart(2,"0"),c=s.toString(16).padStart(2,"0"),E=n.toString(16).padStart(2,"0");return`#${i}${c}${E}`}class K extends M{constructor(r){super();o(this,"pos");o(this,"color");this.pos=r,this.color="#fc664c"}}class I{constructor(t,r,s,n){o(this,"context");o(this,"controller");o(this,"fps");o(this,"gameOverCallback");o(this,"interval");o(this,"punishInterval");o(this,"snake");o(this,"apple");o(this,"points",0);this.context=t,this.controller=r,this.fps=s,this.gameOverCallback=n}start(){this.snake=new $,this.apple=this.spawnApple(),this.setUpdate()}setUpdate(){this.interval=setInterval(this.update.bind(this),1e3/this.fps)}update(){this.move(),this.render(),this.checkCollisions()}move(){this.snake.vel=this.controller.getNewVelocity({snake:this.snake,apple:this.apple}),this.snake.move()}render(){this.context.clearRect(0,0,p*a,f*a),this.fillPixel(this.apple.getPos(),this.apple.getColor()),this.snake.tail.forEach(t=>{this.fillPixel(t.pos,t.color)}),this.fillPixel(this.snake.getPos(),this.snake.getColor())}fillPixel(t,r){this.context.fillStyle=r,this.context.fillRect(t.x*a+1,t.y*a+1,a-2,a-2)}checkCollisions(){if(m(this.snake.getPos(),this.apple.getPos())){this.eatApple();return}if(S(this.snake.getPos())){this.gameOver();return}if(g(this.snake.getPos(),this.snake.tail.map(t=>t.pos))){this.gameOver();return}}spawnApple(){return clearInterval(this.punishInterval),this.punishInterval=setInterval(()=>this.controller.reward(-1),1e3*5),new K(R([this.snake.getPos(),...this.snake.tail.map(t=>t.pos)]))}eatApple(){this.controller.reward(5),document.querySelector("#points").innerHTML=`Points: ${++this.points}`,this.snake.grow(),this.apple=this.spawnApple()}gameOver(){this.controller.reward(-5),clearInterval(this.interval),clearInterval(this.punishInterval),document.querySelector("#points").innerHTML="Points: 0",this.gameOverCallback(this.points)}pause(){clearInterval(this.interval)}resume(){this.setUpdate()}}class q{}function A(e){return U(e)*8+D(e)}function U(e){const t=G(e.apple.getPos(),e.snake.getPos());let r;return Math.abs(t.x)>Math.abs(t.y)?r={x:t.x/Math.abs(t.x),y:0}:r={x:0,y:t.y/Math.abs(t.y)},d(r,k(e.snake.vel))?1:d(r,V(e.snake.vel))?2:d(r,v(e.snake.vel))?3:0}function D(e){const t=[u(e.snake.getPos(),v(e.snake.vel)),u(e.snake.getPos(),e.snake.vel),u(e.snake.getPos(),k(e.snake.vel))];let r=0;for(let s=0;s<t.length;s++)(S(t[s])||g(t[s],e.snake.tail.map(n=>n.pos)))&&(r+=Math.pow(2,s));return r}class W extends q{constructor(){super();o(this,"lastKey","");this.listen()}listen(){window.addEventListener("keydown",r=>{this.lastKey=r.key})}getNewVelocity(r){A(r);let s=r.snake.vel,n={x:0,y:0};switch(this.lastKey){case"ArrowUp":n.y=-1;break;case"ArrowDown":n.y=1;break;case"ArrowLeft":n.x=-1;break;case"ArrowRight":n.x=1;break;default:return s}return n.x==-s.x&&n.y==-s.y?s:n}reward(){}}class B{constructor(){o(this,"table");this.table=Array(32);for(let t=0;t<this.table.length;t++){this.table[t]=Array(3);for(let r=0;r<this.table[t].length;r++)this.table[t][r]=Math.random()}}getBestAction(t){const r=this.table[t],s=Math.max(...r);for(let n=0;n<r.length;n++)if(r[n]==s)return n;return 1}addWeight(t,r){this.table[t.stateIndex][t.action]+=r}randomAction(){return Math.floor(Math.random()*3)}}class y extends q{constructor(){super();o(this,"qTable");o(this,"prevState");o(this,"exploreRate",.5);this.qTable=new B}getNewVelocity(r){N(r.snake.vel)&&(r.snake.vel={x:0,y:-1});const s=A(r),n=this.explore()?this.qTable.getBestAction(s):this.qTable.randomAction();switch(this.prevState={stateIndex:s,action:n},n){case 0:return v(r.snake.vel);case 1:return r.snake.vel;case 2:return k(r.snake.vel);default:return r.snake.vel}}explore(){return this.exploreRate<Math.random()}reduceExploreRate(r){this.exploreRate=.1*Math.pow(.9,r),console.log(this.exploreRate)}reward(r){console.log(r),this.prevState&&this.qTable.addWeight(this.prevState,r)}}let l,x=!1,L=1,h=0;function O(e){var n;let t=+document.querySelector("#fps").value;(n=document.querySelector("#select-controller"))==null||n.remove();const r=document.querySelector("canvas"),s=r==null?void 0:r.getContext("2d");l=new I(s,e,t,C),l.start()}function C(e){F(e),Q()}function F(e){document.querySelector("#generation").innerHTML=`Generation ${++L}`,e>h&&(h=e,document.querySelector("#highscore").innerHTML=`Highscore: ${h}`)}function Q(){let e=l.context,t=l.controller,r=l.fps;t instanceof y&&(t.reduceExploreRate(h),h==0&&L>=20&&(t=new y)),l=new I(e,t,r,C),l.start()}var b;(b=document.querySelector("#keyboard-input"))==null||b.addEventListener("click",()=>{O(new W)});var w;(w=document.querySelector("#ai-input"))==null||w.addEventListener("click",()=>{O(new y)});var P;(P=document.querySelector("#pause-btn"))==null||P.addEventListener("click",()=>{let e="";x?(e="pause.svg",l==null||l.resume()):(e="play.svg",l==null||l.pause()),document.querySelector("#pause-btn").src=e,x=!x});
